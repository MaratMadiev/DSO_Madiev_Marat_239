# Сценарии приемки безопасности (BDD)

## Сценарий 1: Успешная аутентификация с валидными учетными данными
**Feature:** Аутентификация пользователя
```gherkin
Given пользователь с email "test@example.com" и паролем "SecurePass123!"
When он отправляет POST запрос на /auth/login с корректными credentials
Then система должна вернуть статус 200 OK
And ответ должен содержать валидный JWT токен
And время ответа должно быть < 500 мс (p95)
And в логах должна быть запись об успешной аутентификации
```

## Сценарий 2: Защита от неверных учетных данных

**Feature:** Защита от brute-force атак
```gherkin
Given пользователь с IP адресом "192.168.1.100"
When он отправляет 6 неверных попыток аутентификации за 10 минут
Then система должна заблокировать IP на 15 минут
And 6-я попытка должна вернуть статус 429 Too Many Requests
And в логах безопасности должно быть предупреждение
And время ответа для блокировки должно быть < 100 мс
```

## Сценарий 3: Авторизация доступа к данным

Feature: Owner-only доступ к предложениям

```gherkin
Given пользователь Alice с ID 123
And пользователь Bob с ID 456
And предложение с ID 789 созданное Alice
When Bob пытается получить доступ к GET /suggestions/789
Then система должна вернуть 404 Not Found
And Bob не должен видеть что предложение существует
And в audit log должна быть запись о попытке доступа
```

## Сценарий 4: Валидация JWT токена

Feature: Защита API с JWT

```gherkin
Given просроченный JWT токен
When пользователь отправляет запрос к GET /suggestions с этим токеном
Then система должна вернуть статус 401 Unauthorized
And токен должен быть отклонен за < 50 мс
And в ответе должен быть заголовок WWW-Authenticate
```

## Сценарий 5: Обработка инъекционных атак

Feature: Защита от SQL injection

```gherkin
Given злонамеренный запрос с SQL injection в параметрах
When запрос отправляется к API эндпоинтам
Then система должна вернуть статус 400 Bad Request
And никакие SQL команды не должны выполниться
And попытка должна быть залогирована в security log
And время обработки ошибочного запроса < 200 мс
```

## Негативный сценарий 1: Обработка перегрузки
Feature: Rate limiting при DDoS атаке

```gherkin
Given ботнет отправляет 1000+ запросов/секунду
When система получает такой трафик
Then она должна обслуживать только первые 10 RPS с IP
And остальные запросы должны получить 429
And основная функциональность должна оставаться доступной
And CPU usage не должен превышать 80%
```

## Негативный сценарий 2: Граничные значения паролей
Feature: Валидация сложности паролей

```gherkin
Given пользователь пытается установить пароль "123"
When он отправляет POST /auth/register
Then система должна вернуть статус 422 Unvalidation Entity
And пароль не должен быть сохранен в БД
And ошибка должна содержать требования к паролю
```
